# sdk orange-money-burkina

Unofficial SDK for the Orange Money Burkina base API, designed to simplify its usage and integration by developers into
PHP projects. This SDK does not handle the contractual aspect with Orange, and developers must contact Orange directly
to obtain access and credentials.

Before using the SDK, developers must have obtained their credentials from Orange. The SDK takes care of formatting the
XML requests and responses, saving developers time and effort.

With this SDK, developers can easily initiate transactions, handle payment responses, and manage errors. The SDK also
provides optional methods for customizing transaction references and enabling/disabling SSL verification.

Note: This SDK is not affiliated with or endorsed by Orange. It is provided as-is, without any warranty or support from
Orange. Developers are responsible for complying with Orange's terms and conditions when using this SDK.

## Installation via composer

```shell
composer require faso-dev/orange-money-burkina-sdk
```

## Cas d'utilisation

```php

use Fasodev\Sdk\Config\TransactionData;
use Fasodev\Sdk\Exception\TransactionException;
use Fasodev\Sdk\OrangeMoneyAPI;
use Fasodev\Sdk\PaymentSDK;

require_once __DIR__ . '/vendor/autoload.php';

try {
    $orangeApi = (new OrangeMoneyAPI("username", "password", "merchant_number"))
                ->withTransactionData(TransactionData::from('client_number', 'payment_amount', 'otp_code', 'external-reference'))
                ->withCustomReference("123456778") //optionnal, but the internal reference generated by the sdk is used by default
                ->useProdApi() // for production, don't use this method for testing
                ->withoutSSLVerification() //if you have any troubleshoot with ssl verifcation(not recommended)
    ;
    $response = (new PaymentSDK($orangeApi))->handlePayment();
    echo 'Thank you for your purchasse !';
    echo $response->getTransactionId();
} catch (TransactionException $exception) {
    echo "Whoops! Unable to process payment. <br/> 
          Error message returned by request: {$exception->getMessage()}. <br/>
          Error code returned by request: {$exception->getCode()}";
}
```

## Examples of Uses

-   ### PHP Project

In this example, we will demonstrate how to use the Orange Money SDK to initiate a transaction in a PHP project. We will
create a simple command-line script that initiates a transaction using the OrangeMoneyService class.

First, we need to install the SDK using Composer:

```shell
composer require faso-dev/orange-money-burkina-sdk
```

Next, we will create a new PHP file called orange-money.php in the root directory of our project. In this file, we will
instantiate the OrangeMoneyService class and call the initiateTransaction method.

Here's the complete code for orange-money.php:

```php
<?php
// src/Service/OrangeMoneyService.php

namespace App\Service;

use Fasodev\Sdk\Config\TransactionData;
use Fasodev\Sdk\OrangeMoneyAPI;
use Fasodev\Sdk\PaymentSDK;

class OrangeMoneyService
{
    private $orangeMoneyAPI;

    public function __construct()
    {
        $this->orangeMoneyAPI = (new OrangeMoneyAPI(
            getenv('ORANGE_MONEY_USERNAME');
            getenv('ORANGE_MONEY_PASSWORD');
            getenv('ORANGE_MONEY_MERCHANT_NUMBER')
        ))->withCustomReference("123456778") 
            ->useProdApi()
            ->withoutSSLVerification();
    }

    public function initiateTransaction(TransactionData $transactionData): string
    {
        try {
            $response = (new PaymentSDK($this->orangeMoneyAPI->withTransactionData($transactionData)))->handlePayment();
            return $response->getTransactionId();
        } catch (TransactionException $e) {
            // handle exception
        }
    }
}
```

In this example, we've created a new OrangeMoneyService class that encapsulates the logic for initiating a transaction
using the Orange Money SDK. The initiateTransaction method takes a TransactionData object as an argument and returns the
transaction ID.
So we will create a new PHP file called orange-money.php in the root directory of our project. In this file, we will
instantiate the OrangeMoneyService class and call the initiateTransaction method.

```php

<?php
require_once __DIR__ . '/vendor/autoload.php';

use App\Service\OrangeMoneyService;
use Fasodev\Sdk\Config\TransactionData;

// Create a new transaction data object
$transactionData = TransactionData::from(
    '+22670000000', // Replace with the client's phone number
    1000, // Replace with the transaction amount
    '1234', // Replace with the OTP code
    'my-custom-reference' // Replace with a custom reference for the transaction
);

// Initiate the transaction
$transactionId = (new OrangeMoneyService())->initiateTransaction($transactionData);

// Output the transaction ID
echo "Transaction ID: $transactionId\n";
```

In this example, we first require the Composer autoloader and import the necessary classes. We then create a new instance of the OrangeMoneyService class, passing in our Orange Money credentials.

Next, we create a new TransactionData object using the TransactionData::from method. This method takes four arguments: the client's phone number, the transaction amount, the OTP code, and a custom reference for the transaction.

Finally, we call the initiateTransaction method on the OrangeMoneyService instance, passing in the TransactionData object. This method returns the transaction ID, which we output to the console.

That's it! With just a few lines of code, we've initiated a transaction using the Orange Money SDK in a PHP project. Of course, you'll want to replace the placeholder values in the code with your own credentials and transaction data.

-   ### Laravel Project

In this example, we will demonstrate how to use the Orange Money SDK to initiate a transaction in a Laravel project. We will create a new controller that uses the OrangeMoneyService class to initiate
a transaction.

First, we need to install the SDK using Composer:

```shell 
composer require faso-dev/orange-money-burkina-sdk
```

Next, we will create a OrangeMoneyService class in the app/Services directory of our Laravel project. This class will encapsulate the logic for initiating a transaction using the Orange Money SDK.

Here's the complete code for OrangeMoneyService.php:

```php

<?php
// app/Services/OrangeMoneyService.php

namespace App\Services;

use Fasodev\Sdk\Config\TransactionData;
use Fasodev\Sdk\OrangeMoneyAPI;
use Fasodev\Sdk\PaymentSDK;
use Fasodev\Sdk\Exception\TransactionException;
use Fasodev\Sdk\TransactionResponse;

class OrangeMoneyService
{
    private $orangeMoneyAPI;

    public function __construct()
    {
        $this->orangeMoneyAPI = (new OrangeMoneyAPI(
            config('services.orange_money.username'),
            config('services.orange_money.password'),
            config('services.orange_money.merchant_number')
        ))->withCustomReference("123456778") 
            ->useProdApi()
            ->withoutSSLVerification();
    }

    public function initiatePayment(TransactionData $transactionData): TransactionResponse
    {
        try {
            return (new PaymentSDK($this->orangeMoneyAPI->withTransactionData($transactionData)))->handlePayment();
        } catch (TransactionException $e) {
            // handle exception
        }
    }
}
```

Now that we have created the OrangeMoneyService class, we can create a service provider to bind the service to the Laravel container. We will create a new service provider called OrangeMoneyServiceProvider in the app/Providers directory of our Laravel project.

Here's the complete code for OrangeMoneyServiceProvider.php:

```php
// app/Providers/OrangeMoneyServiceProvider.php

namespace App\Providers;

use App\Services\OrangeMoneyService;
use Illuminate\Support\ServiceProvider;

class OrangeMoneyServiceProvider extends ServiceProvider
{
    public function register()
    {
        $this->app->singleton(OrangeMoneyService::class, function () {
            return new OrangeMoneyService();
        });
    }
}
```

Next, we need to register the service provider in the ```config/app.php``` file of our Laravel project.
Add the following line to the providers array:

```php
[
    //...
    App\Providers\OrangeMoneyServiceProvider::class,
    //...
]
```

Now that we have registered the OrangeMoneyService class with the Laravel container, we can use it in our controllers.
Let's create a new controller called PaymentController in the ```app/Http/Controllers``` directory of our Laravel project.

Here's the complete code for PaymentController.php:

```php
// app/Http/Controllers/PaymentController.php

namespace App\Http\Controllers;

use App\Services\OrangeMoneyService;

class PaymentController extends Controller
{
    private $orangeMoneyService;

    public function intentPayment(OrangeMoneyService $orangeMoneyService, OrangeMoneyRequest $request)
    {
        $transactionData = $this->createTransactionDataFromRequest($request);

        $transaction = $orangeMoneyService->initiatePayment($transactionData);

        return response()->json([
            'transaction_id' => $transaction->getTransactionId(),
            'message' => 'Payment initiated successfully'
            
        ]);
    }
    
    private function createTransactionDataFromRequest(OrangeMoneyRequest $request): TransactionData
    {
        return TransactionData::from(
            $request->input('phone_number'),
            $request->input('amount'),
            $request->input('otp_code'),
            $request->input('reference')
        );
    }
}
```

In this example, we've created a new PaymentController class that uses the OrangeMoneyService class to initiate a transaction. The intentPayment method takes an OrangeMoneyService instance and an OrangeMoneyRequest object as arguments. It creates a TransactionData object from the request data and passes it to the initiatePayment method of the OrangeMoneyService instance.

Finally, the method returns a JSON response with the transaction ID and a success message.

-  ### Symfony Project

In this example, we will demonstrate how to use the Orange Money SDK to initiate a transaction in a Symfony project.
We will create a new controller that uses the OrangeMoneyService class to initiate
a transaction.

First, we need to install the SDK using Composer:

```shell
composer require faso-dev/orange-money-burkina-sdk
```

Next, we will create a OrangeMoneyService class in the ```src/Services``` directory of our Symfony project.
This class will encapsulate the logic for initiating a transaction using the Orange Money SDK.

Here's the complete code for ```OrangeMoneyService.php```:

```php
// src/Services/OrangeMoneyService.php

namespace App\Services;

use Fasodev\Sdk\Config\TransactionData;
use Fasodev\Sdk\OrangeMoneyAPI;
use Fasodev\Sdk\PaymentSDK;
use Fasodev\Sdk\Exception\TransactionException;
use Fasodev\Sdk\TransactionResponse;

class OrangeMoneyService
{
    private $orangeMoneyAPI;
    
    public function __construct(
        string $username,
        string $password,
        string $merchantNumber
    ) {
        $this->$orangeMoneyAPI = (new OrangeMoneyAPI(
        $username,
         $password, 
         $merchantNumber
         ))->withCustomReference("123456778") 
            ->useProdApi()
            ->withoutSSLVerification();
    }
    
    public function initiatePayment(TransactionData $transactionData): TransactionResponse
    {
        try {
            return (new PaymentSDK($this->orangeMoneyAPI->withTransactionData($transactionData)))->handlePayment();
        } catch (TransactionException $e) {
            // handle exception
        }
}
```

Now we need to tell Symfony to autowire the OrangeMoneyService class. We will create a new service definition in the ```services.yaml``` file in the ```config``` directory of our Symfony project.

Here's the complete code for ```services.yaml```:

```yaml
# config/services.yaml

services:
    App\Services\OrangeMoneyService:
        arguments:
            $username: '%env(ORANGE_MONEY_USERNAME)%'
            $password: '%env(ORANGE_MONEY_PASSWORD)%'
            $merchantNumber: '%env(ORANGE_MONEY_MERCHANT_NUMBER)%'
```

Next, we need to create a new controller called ```PaymentController.php``` in the ```src/Controller``` directory of our Symfony project.

Here's the complete code for ```PaymentController.php```:

```php
// src/Controller/PaymentController.php

namespace App\Controller;

use App\Services\OrangeMoneyService;
use Fasodev\Sdk\Config\TransactionData;
use Fasodev\Sdk\Exception\TransactionException;

class PaymentController extends AbstractController
{
    private $orangeMoneyService;

    public function __construct(OrangeMoneyService $orangeMoneyService)
    {
        $this->orangeMoneyService = $orangeMoneyService;
    }

    public function intentPayment(Request $request): JsonResponse
    {
        $transactionData = $this->createTransactionDataFromRequest($request);

        try {
            $transaction = $this->orangeMoneyService->initiatePayment($transactionData);

            return new JsonResponse([
                'transaction_id' => $transaction->getTransactionId(),
                'message' => 'Payment initiated successfully'
            ]);
        } catch (TransactionException $e) {
            return new JsonResponse([
                'error' => 'Unable to process payment',
                'message' => $e->getMessage()
            ], 400);
        }
    }

    private function createTransactionDataFromRequest(Request $request): TransactionData
    {
        return TransactionData::from(
            $request->get('phone_number'),
            $request->get('amount'),
            $request->get('otp_code'),
            $request->get('reference')
        );
    }
}
```

In this example, we've created a new PaymentController class that uses the OrangeMoneyService class to initiate a transaction. The intentPayment method takes a Request object as an argument and creates a TransactionData object from the request data. It then calls the initiatePayment method of the OrangeMoneyService instance and returns a JSON response with the transaction ID and a success message.

## Testing

Exécutez les tests avec:

```bash
vendor/bin/phpunit
```

ou

```bash
composer tests
```

## Authors

- https://github.com/faso-dev
- https://github.com/yenteck

Merci de contribuer !
